(d=>{d(document).ready(function(){var e=d("#cooked-migration-button"),o=d("#cooked-import-button"),t=d("#cooked-csv-import-button"),s=(d("#cooked-csv-import-form"),d("#cooked-migration-progress"),d("#cooked-migration-progress-text"),d("#cooked-csv-import-progress")),a=d("#cooked-csv-import-progress-text");e.length&&e.on("click",function(e){e.preventDefault();e=d(this);confirm(cooked_migration_js_vars.i18n_confirm_migrate_recipe)&&!e.hasClass("disabled")&&(e.addClass("disabled").attr("disabled",!0),e.hide(),d.post(cooked_migration_js_vars.ajax_url,{action:"cooked_get_migrate_ids"},function(e){var o;e&&(o=JSON.parse(e),0<Object.keys(o).length)&&cooked_migrate_recipes(e,total_recipe)}))}),o.length&&o.on("click",function(e){e.preventDefault();var t=d(this),i=t.data("import-type");confirm(cooked_migration_js_vars.i18n_confirm_import_recipes)&&!t.hasClass("disabled")&&(t.addClass("disabled").attr("disabled",!0),t.hide(),d.post(cooked_migration_js_vars.ajax_url,{action:"cooked_get_import_ids",import_type:i},function(e){var o;e?(o=JSON.parse(e),0<(o=Object.keys(o).length)&&cooked_import_recipes(e,o,i)):(console.log("Something went wrong"),t.addClass("disabled").attr("disabled",!1),t.show())}))}),t.length&&t.on("click",function(e){e.preventDefault();var o,t=d(this),i=d("#cooked-csv-file"),e=i[0].files[0],r=d("#cooked-csv-import-errors");r.hide().empty(),e?"text/csv"===e.type||e.name.endsWith(".csv")?t.hasClass("disabled")||confirm(cooked_migration_js_vars.i18n_confirm_import_recipes||"Are you sure you want to import recipes from this CSV file?")&&(t.addClass("disabled").attr("disabled",!0),i.attr("disabled",!0),(o=new FormData).append("action","cooked_upload_csv"),o.append("csv_file",e),s.hasClass("cooked-active")||(s.addClass("cooked-active"),a.addClass("cooked-active"),s.find(".cooked-progress-bar").css({width:"0%"}),a.text("Uploading...")),d.ajax({url:cooked_migration_js_vars.ajax_url,type:"POST",data:o,processData:!1,contentType:!1,success:function(e){e.success?(a.text("Processing..."),s.find(".cooked-progress-bar").css({width:"50%"}),d.post(cooked_migration_js_vars.ajax_url,{action:"cooked_process_csv",transient_key:e.data.transient_key},function(e){var o;e.success?(s.find(".cooked-progress-bar").css({width:"100%"}),a.text(e.data.success+" / "+e.data.total+" recipes imported"),e.data.errors&&0<e.data.errors.length&&(o="<p><strong>Errors:</strong></p><ul>",e.data.errors.forEach(function(e){o+="<li>"+e+"</li>"}),o+="</ul>",r.html(o).show()),setTimeout(function(){s.hide(),a.hide(),d("#cooked-csv-import-completed").show(),t.hide(),i.hide()},2e3)):(r.html("<p>"+(e.data.message||"Import failed.")+"</p>").show(),e.data.errors&&0<e.data.errors.length&&(o="<ul>",e.data.errors.forEach(function(e){o+="<li>"+e+"</li>"}),o+="</ul>",r.append(o)),t.removeClass("disabled").attr("disabled",!1),i.attr("disabled",!1),s.removeClass("cooked-active"),a.removeClass("cooked-active"))},"json").fail(function(){r.html("<p>Failed to process CSV file.</p>").show(),t.removeClass("disabled").attr("disabled",!1),i.attr("disabled",!1),s.removeClass("cooked-active"),a.removeClass("cooked-active")})):(r.html("<p>"+(e.data.message||"File upload failed.")+"</p>").show(),t.removeClass("disabled").attr("disabled",!1),i.attr("disabled",!1),s.removeClass("cooked-active"),a.removeClass("cooked-active"))},error:function(){r.html("<p>Failed to upload CSV file.</p>").show(),t.removeClass("disabled").attr("disabled",!1),i.attr("disabled",!1),s.removeClass("cooked-active"),a.removeClass("cooked-active")}})):(e=cooked_migration_js_vars.i18n_csv_invalid_file||"Please select a valid CSV file.",r.html("<p>"+e+"</p>").show()):(o=cooked_migration_js_vars.i18n_csv_no_file||"Please select a CSV file.",r.html("<p>"+o+"</p>").show())})})})(jQuery);{function cookedDecimalAdjust(e,o,t){return void 0===t||0==+t?Math[e](o):(t=+t,null===(o=+o)||isNaN(o)||"number"!=typeof t||t%1!=0?NaN:o<0?-cookedDecimalAdjust(e,-o,t):(o=o.toString().split("e"),+((o=(o=Math[e](+(o[0]+"e"+(o[1]?+o[1]-t:-t)))).toString().split("e"))[0]+"e"+(o[1]?+o[1]+t:t))))}}Math.round10||(Math.round10=function(e,o){return cookedDecimalAdjust("round",e,o)});var cooked_recipe_migrate_counter=0,progressIterations=0;function cooked_migrate_recipes(e,s){var a,d,c,o,n=0;0<s&&(a=jQuery("#cooked-migration-progress"),d=a.find(".cooked-progress-bar"),c=jQuery("#cooked-migration-progress-text"),a.hasClass("cooked-active")||(a.addClass("cooked-active"),c.addClass("cooked-active"),d.css({width:"0%"})),o=JSON.parse(e),Object.keys(o).length,s.toLocaleString(),jQuery.post(cooked_migration_js_vars.ajax_url,{action:"cooked_migrate_recipes",recipe_ids:e},function(e){var o,t,i,r;e&&"false"!=e&&0!=e?(o=JSON.parse(e),o=Object.keys(o).length,cooked_recipe_migrate_counter=s-o,(o=s).toLocaleString(),(t=cooked_recipe_migrate_counter).toLocaleString(),(n=Math.round10(cooked_recipe_migrate_counter/s*100,-1))<2&&(n=2),d.css({width:n+"%"}),r=100-n,r=Math.round(r/n*progressIterations),progressIterations+=1,n<100&&3<n&&isFinite(r)?(i=Math.floor(r/3600),r=Math.floor(r/60%60),1<=i?c.html(t+" / "+o+"<strong style='display:inline-block; float:right;'>"+i+" hrs, "+r+" mins "+cooked_migration_js_vars.i18n_remaining+"</strong>"):1<=r?c.html(t+" / "+o+"<strong style='display:inline-block; float:right;'>"+r+" mins "+cooked_migration_js_vars.i18n_remaining+"</strong>"):c.text(t+" / "+o)):c.text(t+" / "+o),cooked_migrate_recipes(e,s)):(a.hide(),c.hide(),jQuery(".recipe-setting-block.migrate_button").find("h3").hide(),jQuery(".recipe-setting-block.migrate_button").find("p:nth-child(2)").hide(),jQuery(".recipe-setting-block.migrate_button").find("ul.cooked-admin-ul").hide(),jQuery("#cooked-migration-button").hide(),jQuery("#cooked-migration-completed").addClass("cooked-active"))}))}function cooked_import_recipes(e,s,a){var d,c,n,o,l=0;0<s&&(d=jQuery("#cooked-import-progress"),c=d.find(".cooked-progress-bar"),n=jQuery("#cooked-import-progress-text"),d.hasClass("cooked-active")||(d.addClass("cooked-active"),n.addClass("cooked-active"),c.css({width:"0%"})),o=JSON.parse(e),Object.keys(o).length,s.toLocaleString(),jQuery.post(cooked_migration_js_vars.ajax_url,{action:"cooked_import_recipes",recipe_ids:e,import_type:a},function(e){var o,t,i,r;e&&"false"!=e&&0!=e?(o=JSON.parse(e),o=Object.keys(o).length,cooked_recipe_migrate_counter=s-o,(o=s).toLocaleString(),(t=cooked_recipe_migrate_counter).toLocaleString(),(l=Math.round10(cooked_recipe_migrate_counter/s*100,-1))<2&&(l=2),c.css({width:l+"%"}),r=100-l,r=Math.round(r/l*progressIterations),progressIterations+=1,l<100&&3<l&&isFinite(r)?(i=Math.floor(r/3600),r=Math.floor(r/60%60),1<=i?n.html(t+" / "+o+"<strong style='display:inline-block; float:right;'>"+i+" hrs, "+r+" mins "+cooked_migration_js_vars.i18n_remaining+"</strong>"):1<=r?n.html(t+" / "+o+"<strong style='display:inline-block; float:right;'>"+r+" mins "+cooked_migration_js_vars.i18n_remaining+"</strong>"):n.text(t+" / "+o)):n.text(t+" / "+o),cooked_import_recipes(e,s,a)):(d.hide(),n.hide(),jQuery(".recipe-setting-block.import_button").find("h3").hide(),jQuery(".recipe-setting-block.import_button").find("p:nth-child(2)").hide(),jQuery(".recipe-setting-block.import_button").find(".cooked-import-note").hide(),jQuery(".recipe-setting-block.import_button").find("ul.cooked-admin-ul").hide(),jQuery("#cooked-import-button").hide(),jQuery("#cooked-import-completed").addClass("cooked-active"))}))}